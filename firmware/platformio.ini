; PlatformIO Project Configuration File
; J1939/J1708 Dashboard Project
; 
; Build options: build flags, source filter
; Upload options: custom upload port, speed and extra flags
; Library options: dependencies, extra library storages
; Advanced options: extra scripting

; Default environment for regular builds
[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino

; Serial monitor
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; Build flags
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=0

; Libraries
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0

; Partition scheme with more space for code
board_build.partitions = default.csv

; Upload speed
upload_speed = 921600

; Native test environment (for running parser unit tests on host)
[env:native]
platform = native
build_flags = 
    -std=c++11
    -DNATIVE_BUILD
    -DUNITY_INCLUDE_DOUBLE
    -Itest
lib_deps = 
    throwtheswitch/Unity@^2.5.2
test_framework = unity
test_ignore = test_embedded/*
; Don't build src for native - libraries in lib/ are picked up automatically
build_src_filter = -<*>

; ESP32 test environment
[env:esp32dev_test]
platform = espressif32
board = esp32dev
framework = arduino
test_framework = unity
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DUNITY_INCLUDE_DOUBLE
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
    throwtheswitch/Unity@^2.5.2

; Simulation mode - run on ESP32 without CAN/J1708 hardware
[env:esp32dev_sim]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=0
    -DSIMULATION_MODE=1
    -DDEBUG_PARSED_VALUES=1
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0
upload_speed = 921600
